# Changesets version pipeline â€” mirrors .github/workflows/changesets.yml

changeset:version:
  stage: changeset
  script:
    - git config user.email "ci@xonovex.com"
    - git config user.name "Xonovex CI"
    - git remote set-url origin "https://oauth2:${GITLAB_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_PATH}.git"
    - nix develop --command bash -c "npm ci && npm run release:version"
    - |
      if git diff --quiet; then
        echo "No version changes to commit"
      else
        git add .
        git commit -m "chore: version packages"
        git push origin HEAD:main
      fi
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
    - if: '$CI_PIPELINE_SOURCE == "web"'
