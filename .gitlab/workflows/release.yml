# Release pipeline â€” mirrors .github/workflows/release.yml

release:
  stage: release
  extends: .workspace_cache
  script:
    - rm -f .moon/cache/runReport.json .moon/cache/ciReport.json
    - |
      if [ "$DRY_RUN" = "true" ]; then
        TARGETS=":ci-publish-dry-run"
      else
        TARGETS=":ci-publish"
      fi
      npx moon ci --color --concurrency 1 --affected $TARGETS
  rules:
    - if: "$CI_COMMIT_TAG =~ /^v/"
    - if: '$CI_PIPELINE_SOURCE == "web"'
    - if: '$CI_COMMIT_BRANCH == "main" && $CI_COMMIT_TITLE =~ /^chore: version packages/'
