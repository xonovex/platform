# Release pipeline â€” mirrors .github/workflows/release.yml

release:
  stage: release
  extends: .workspace_cache
  script:
    - echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > .npmrc
    - |
      if [ "$DRY_RUN" = "true" ]; then
        npx moon ci --concurrency 1 --color :ci-publish-dry-run
      else
        npx moon ci --concurrency 1 --color :ci-publish
      fi
  rules:
    - if: "$CI_COMMIT_TAG =~ /^v/"
    - if: '$CI_PIPELINE_SOURCE == "web"'
    - if: '$CI_COMMIT_BRANCH == "main" && $CI_COMMIT_TITLE =~ /^chore: version packages/'
