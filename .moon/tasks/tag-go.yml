$schema: https://moonrepo.dev/schemas/tasks.json
implicitInputs:
- go.mod
- go.sum
fileGroups:
  sources:
  - '**/*.go'
  tests:
  - '**/*_test.go'
  configs:
  - go.mod
  - go.sum
  - .golangci.yml
tasks:
  go-build:
    deps:
    - ^:go-build
    command:
    - go
    - build
    - ./...
    inputs:
    - '@globs(sources)'
    - go.mod
    - go.sum
    outputs: []
    options:
      cache: true
      runInCI: true
  go-test:
    command:
    - go
    - test
    - -v
    - ./...
    deps:
    - ^:go-build
    inputs:
    - '@globs(sources)'
    - '@globs(tests)'
    outputs: []
    options:
      cache: true
      runInCI: true
  go-test-coverage:
    command:
    - go
    - test
    - -v
    - -coverprofile=coverage.out
    - ./...
    deps:
    - ^:go-build
    inputs:
    - '@globs(sources)'
    - '@globs(tests)'
    outputs:
    - coverage.out
    options:
      cache: true
      runInCI: true
  go-lint:
    command:
    - golangci-lint
    - run
    - --allow-parallel-runners
    - ./...
    inputs:
    - '@globs(sources)'
    - '@globs(tests)'
    - .golangci.yml
    outputs: []
    options:
      cache: false
      runInCI: true
  go-fmt:
    command:
    - go
    - fmt
    - ./...
    inputs:
    - '@globs(sources)'
    - '@globs(tests)'
    outputs: []
    options:
      cache: false
      runInCI: false
  go-fmt-check:
    command:
    - bash
    - -c
    - test -z "$(gofmt -l .)"
    inputs:
    - '@globs(sources)'
    - '@globs(tests)'
    outputs: []
    options:
      cache: true
      runInCI: true
  go-typecheck:
    command:
    - go
    - vet
    - ./...
    deps:
    - ^:go-build
    inputs:
    - '@globs(sources)'
    - '@globs(tests)'
    outputs: []
    options:
      cache: true
      runInCI: true
  go-tidy:
    command:
    - go
    - mod
    - tidy
    inputs:
    - go.mod
    - go.sum
    outputs:
    - go.mod
    - go.sum
    options:
      cache: false
      runInCI: false
  ci-check:
    command: echo 'ci-check complete'
    deps: [go-build, go-test, go-lint, go-fmt-check, go-typecheck]
    options:
      cache: false
  go-clean:
    script: rm -rf dist coverage.out
    options:
      cache: false
      runInCI: false
inheritedBy:
  tag: go
