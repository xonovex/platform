$schema: https://moonrepo.dev/schemas/project.json
language: go
layer: application
tags:
  - go
  - docker
dependsOn:
  - shared-core-go
  - shared-agent-go
tasks:
  docker-build:
    command:
      - docker
      - build
      - -f
      - packages/agent/agent-operator-go/Dockerfile
      - -t
      - agent-operator:latest
      - .
    inputs:
      - '@globs(sources)'
      - '@globs(dockerfiles)'
    outputs: []
    options:
      cache: false
      runFromWorkspaceRoot: true
  go-test-integration:
    command:
      - go
      - test
      - -tags=integration
      - -v
      - -timeout=300s
      - ./test/integration/
    deps:
      - go-build
    inputs:
      - '@globs(sources)'
      - '@globs(tests)'
    outputs: []
    options:
      cache: false
  go-test-e2e:
    command:
      - go
      - test
      - -tags=e2e
      - -v
      - -timeout=600s
      - ./test/e2e/
    deps:
      - go-build
    inputs:
      - '@globs(sources)'
      - '@globs(tests)'
    outputs: []
    options:
      cache: false
