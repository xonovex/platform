$schema: https://moonrepo.dev/schemas/project.json
id: agent-cli-go-linux-arm64
type: library
language: other
env:
  GOOS: linux
  GOARCH: arm64
  CGO_ENABLED: "0"
  BIN_EXT: ""

tasks:
  go-build:
    command: "bash -c 'mkdir -p bin && cd $workspaceRoot/packages/cli/agent-cli-go && go build -ldflags=\"-s -w\" -o \"$projectRoot/bin/agent-cli-go${BIN_EXT}\" ./cmd/agent-cli'"
    inputs: []
    outputs:
      - "bin/"
    options:
      cache: true
      runInCI: true

  npm-publish:
    command:
      - "npm"
      - "publish"
      - "--provenance"
      - "--access"
      - "public"
    deps:
      - "go-build"
    options:
      runInCI: false
      cache: false

  npm-publish-dry-run:
    command:
      - "npm"
      - "pack"
      - "--dry-run"
    options:
      runInCI: false
      cache: false

  ci-publish:
    command: "echo 'ci-publish complete'"
    deps:
      - "npm-publish"
    options:
      runInCI: false
      cache: false

  ci-publish-dry-run:
    command: "echo 'ci-publish-dry-run complete'"
    deps:
      - "npm-publish-dry-run"
    options:
      runInCI: false
      cache: false
